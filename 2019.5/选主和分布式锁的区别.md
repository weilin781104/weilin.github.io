分布式锁是为了多台服务器同时操作某个共同资源获取权限，会频繁切换，就是频繁的选主。

以数据库实现为例：

服务器从锁表读取记录，如果没有就插入记录（服务器名，过期时间），获得锁，做完事情就删除锁记录

如果有，就查看记录的过期时间，如果还没过期，就未获得锁，稍后再试

如果已过期，就更新成自己的服务名和过期时间，获得锁，做完事情就删除锁记录



为了防止获得锁的任务还没执行完，锁记录就过期了，还需要续期





选主是在很长一段时间内，多台服务器其中一台获取主动权，所以需要对锁进行续期操作。

以数据库实现为例：

服务器从锁表读取记录，如果没有就插入记录（服务器名，过期时间），插入成功就获得主资格；如果插入失败则可能被别的服务器抢主成功，丧失主资格，稍后再试

如果有记录则查看服务器名是否为自己，如果为自己则为修改过期时间续期，仍然获得主资格；如果修改失败则可能被别的服务器抢主成功，丧失主资格，稍后再试

如果不是自己，则查看过期时间，如果未过期，则未获得主资格；如果已过期，则修改服务器名和过期时间，获得主资格；如果修改失败则可能被别的服务器抢主成功，则未获得主资格，稍后再试



总体来说，数据库效率比较低，适合选主，缓存方式适合分布式锁。